{% extends 'base.html' %}
{% block js_block %}
{% endblock %}

{% block title_block %}
<title>ë²”ì£„ ìƒê´€ê´€ê³„ ë¶„ì„</title>
{% endblock %}

{% block content_block %}
<div class="breadcrumbs">
    <div class="col-sm-4">
        <div class="page-header float-left">
            <div class="page-title">
                <h1>ë²”ì£„ ìƒê´€ê´€ê³„ ë¶„ì„</h1>
            </div>
        </div>
    </div>
    <div class="col-sm-8">
        <div class="page-header float-right">
            <div class="page-title">
                <ol class="breadcrumb text-right">
                    <li><a href="{{url_for('main.index')}}">Main Page</a></li>
                    <li><a href="#">ë¶„ì„</a></li>
                    <li class="active">ë²”ì£„ ìƒê´€ê´€ê³„</li>
                </ol>
            </div>
        </div>
    </div>
</div>



<!-- âœ… ë‹¨ì¼ Formìœ¼ë¡œ ê°ì‹¸ê¸° ì‹œì‘ -->
<form method="POST" action="{{ url_for('data.crime_insight_page') }}">
<div class="content mt-3">
    <div class="animated fadeIn">    
        <div class="row">
            <div class="col-md-12">

                <!-- ì¹´ë“œ 1: ë²”ì£„ ë¶„ë¥˜ ì„ íƒ -->
                <div class="card">
                    <div class="card-header"><strong>ì¡°ê±´ ì„ íƒ</strong></div>
                    <div class="card-body">
                        <div class="form-group col-12">
                            <label for="category">ğŸ” ë²”ì£„ ë¶„ë¥˜</label>
                            <select name="category" class="form-control" onchange="this.form.submit()">
                                {% for c in crime_categories %}
                                <option value="{{ c }}" {% if c == selected_category %}selected{% endif %}>{{ c }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        {% if selected_details %}
                        <div class="mt-3">
                            <label><i class="fa fa-thumb-tack"></i> 
                                <strong style="color:green">{{ selected_category }}</strong> ì— í¬í•¨ëœ ì„¸ë¶€ ë²”ì£„:</label><br>
                            <p>{{ selected_details }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ì¹´ë“œ 2: ì§€ì—­ ì„ íƒ + íˆíŠ¸ë§µ (Plotly) -->
                <div class="card mt-4">
                    <div class="card-header">
                        <strong>ğŸ“Š {{ selected_region }}ì˜ ë²”ì£„ ë°œìƒë¥  ìƒê´€ê´€ê³„ (10ë§Œ ëª…ë‹¹)</strong>                        
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">â€» ë‹¨ìœ„: ë°œìƒë¥  = ì¸êµ¬ 10ë§Œ ëª…ë‹¹ ë°œìƒ ê±´ìˆ˜ ê¸°ì¤€</p>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="region">ğŸ“ ì§€ì—­</label>
                                <select name="region" class="form-control" onchange="this.form.submit()">
                                    {% for r in region_options %}
                                    <option value="{{ r }}" {% if r == selected_region %}selected{% endif %}>{{ r }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="mt-3">
                            {{ heatmap_html | safe }}
                        </div>
                    </div>
                </div>

                

                <!-- âœ… ì¹´ë“œ: 2ê°œì˜ ë²”ì£„ í•­ëª© ë¹„êµ (ì´ì¤‘ yì¶• Plotly) -->
                <div class="card mt-4">
                    <div class="card-header">
                        <strong>ğŸ“‰ {{ selected_region }}ì˜ ë²”ì£„ ë°œìƒë¥  ì¶”ì´ ë¹„êµ</strong>
                    </div>
                    <div class="card-body">
                        <p class="text-muted small">â€» ì„œë¡œ ë‹¤ë¥¸ yì¶•ìœ¼ë¡œ ë‘ ë²”ì£„ í•­ëª©ì˜ ë°œìƒ ì¶”ì´ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>

                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label>ë²”ì£„ í•­ëª© 1</label>
                                <select name="trend_crime1" class="form-control" onchange="this.form.submit()">
                                    {% for label in trend_labels %}
                                    <option value="{{ label }}" {% if label == selected_trend1 %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label>ë²”ì£„ í•­ëª© 2</label>
                                <select name="trend_crime2" class="form-control" onchange="this.form.submit()">
                                    {% for label in trend_labels %}
                                    <option value="{{ label }}" {% if label == selected_trend2 %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="mt-3">
                            {{ compare_trend_html | safe }}
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header"><strong>ğŸ“ˆ ì§€ì—­ë³„ ì—°ë„ë³„ ë°œìƒë¥  ì¶”ì´</strong></div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="trend_crime">ë²”ì£„ í•­ëª© ì„ íƒ</label>
                            <select name="trend_crime" class="form-control" onchange="this.form.submit()">
                                {% for label in trend_labels %}
                                <option value="{{ label }}" {% if label == selected_trend %}selected{% endif %}>
                                    {{ label }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mt-3">
                            {{ trend_html | safe }}
                        </div>
                        
                    </div>
                    
                </div><!-- â”€â”€ ì˜ˆì¸¡ ì¡°ê±´ ì¹´ë“œ â”€â”€ -->
                <div class="card mt-4">
                  <div class="card-header"><strong>ğŸ”® ì˜ˆì¸¡ ì¡°ê±´</strong></div>
                  <div class="card-body">
                    <div class="form-row align-items-end">
                      <!-- ì˜ˆì¸¡ ë²”ì£„ ì„ íƒ -->
                      <div class="form-group col-md-6">
                        <label for="pred_target">ì˜ˆì¸¡ ë²”ì£„</label>
                        <select name="pred_target" id="pred_target" class="form-control">
                          {% for label in trend_labels %}
                          <option value="{{ label }}" {% if label == pred_target %}selected{% endif %}>
                            {{ label }}
                          </option>
                          {% endfor %}
                        </select>
                      </div>
                      <!-- ì˜ˆì¸¡ ì—°ë„ ì„ íƒ -->
                      <div class="form-group col-md-4">
                        <label for="pred_year">ì˜ˆì¸¡ ì—°ë„</label>
                        <select name="pred_year" id="pred_year" class="form-control">
                          {% for y in range(2016, 2025) %}
                          <option value="{{ y }}" {% if y == pred_year %}selected{% endif %}>{{ y }}</option>
                          {% endfor %}
                        </select>
                      </div>
                      <!-- ì˜ˆì¸¡ ë²„íŠ¼ -->
                      <div class="form-group col-md-2">
                        <button type="submit" class="btn btn-primary btn-block">ì˜ˆì¸¡</button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- ì˜ˆì¸¡ ê²°ê³¼ ì¹´ë“œ -->
                {% if pred_html %}
                <div class="card mt-4">
                    <div class="card-header"><strong>ğŸ“Š ì˜ˆì¸¡ ê²°ê³¼</strong></div>
                    <div class="card-body">
                    <p><strong>ì˜ˆì¸¡ í•­ëª©:</strong> {{ pred_target }}</p>
                    <p><strong>ì˜ˆì¸¡ ì—°ë„:</strong> {{ pred_year }}</p>
                    <p><strong>ì˜ˆì¸¡ê°’:</strong> {{ pred_value }} ê±´/10ë§Œëª…</p>
                    {% if pred_error and pred_error.mae is defined %}
                    <p class="text-muted small">
                        MAE: {{ pred_error.mae | round(2) }}ã€€
                        MAPE: {{ (pred_error.mape * 100) | round(2) }}%
                    </p>
                    {% endif %}
                    <div class="mt-3">
                        {{ pred_html | safe }}
                    </div>
                    </div>
                </div>
                {% endif %}


            </div>
            
        </div>
        
    </div>

    
</div>



</form>
<!-- âœ… Form ë -->


{% endblock %}