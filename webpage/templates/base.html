<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Crime">
    
    {% block title_block %}
    <title>범죄의 현황 PROJECT</title>
    {% endblock %}

    {% include "page_modules/common_css.html" %}
    {% block css_block %}
    {% endblock %}


</head>

<body>

    <!-- Left Panel -->
    <aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">

            <div class="navbar-header">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="{{ url_for('main.index') }}"><img src="/static/images/logo.png" alt="Logo"></a>
                <a class="navbar-brand hidden" href="{{ url_for('main.index') }}"><img src="/static/images/logo2.png" alt="Logo"></a>
            </div>

            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="{{ url_for('main.index') }}"> <i class="menu-icon fa fa-dashboard"></i>Main Page</a>
                    </li>
                    <h3 class="menu-title">범죄 종류 및 분석</h3><!-- /.menu-title -->
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-table"></i>Tables</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="fa fa-table"></i><a href="{{ url_for('data.crime_data_11_22') }}">범죄 현황 Table</a></li>
                            <li><i class="fa fa-table"></i><a href="{{ url_for('data.ent_data') }}">유흥 주점 table</a></li>
                            <li><i class="fa fa-table"></i><a href="tables-data.html">생활 환경 Table</a></li>
                            <li><i class="fa fa-table"></i><a href="tables-data.html">사회 경제 Table</a></li>
                        </ul>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-bar-chart"></i>Charts</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-area-chart"></i><a href="{{ url_for('data.crime_chart') }}">지역별 범죄 chart</a></li>
                            <li><i class="menu-icon fa fa-area-chart"></i><a href="{{ url_for('data.crime_chart2') }}">범죄 유형별 chart</a></li>
                            <li><i class="menu-icon fa fa-line-chart"></i><a href="charts-flot.html">Flot Chart</a></li>
                            <li><i class="menu-icon fa fa-pie-chart"></i><a href="charts-peity.html">Peity Chart</a></li>
                            <li><i class="menu-icon fa fa-map-o"></i><a href="maps-gmap.html">지역 자세히 보기</a></li>
                        </ul>
                    </li>

                    <h3 class="menu-title">계정 관리</h3><!-- /.menu-title -->
                    {% if session.get('loginuser') %}

                    {% else %}
                    <li class="menu-item-has-children dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="menu-icon fa fa-glass"></i>계정관리</a>
                        <ul class="sub-menu children dropdown-menu">
                            <li><i class="menu-icon fa fa-sign-in"></i><a href="{{ url_for('auth.login') }}">로그인</a></li>
                            <li><i class="fa fa-user"></i><a href="{{ url_for('auth.register') }}">회원가입</a></li>
                            <li><i class="menu-icon fa fa-paper-plane"></i><a href="{{ url_for('auth.forget_password') }}">비밀번호 찾기</a></li>
                        </ul>
                    </li>
                    {% endif %}
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
    </aside>
    <!-- Left Panel end -->

    <!-- Right Panel 1 -->
    <div id="right-panel" class="right-panel">

        <!-- Header-->
        <header id="header" class="header">

            <div class="header-menu">

                <div class="col-sm-7">
                    <a id="menuToggle" class="menutoggle pull-left"><i class="fa fa fa-tasks"></i></a>
                    <div class="header-left">
                        <button class="search-trigger"><i class="fa fa-search"></i></button>
                        <div class="form-inline">
                            <form class="search-form">
                                <input class="form-control mr-sm-2" type="text" placeholder="Search ..." aria-label="Search">
                                <button class="search-close" type="submit"><i class="fa fa-close"></i></button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-sm-5">
                    <div class="user-area dropdown float-right">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="user-avatar rounded-circle" 
                                src="{% if session.get('loginuser') %} /static/images/admin.jpg {% else %}/static/images/default_admin.jpg{% endif %}" 
                                alt="User Avatar">
                        </a>

                        <div class="user-menu dropdown-menu">    
                            <a class="nav-link" href="#"><i class="fa fa-cog"></i> 설정</a>
                            
                            {% if session.get('loginuser') %}
                            <a class="nav-link" href="#"><i class="fa fa-user"></i> 나의 프로필</a>
                            <!-- <a class="nav-link" href="#"><i class="fa fa-user"></i> Notifications <span class="count"></span></a> -->
                            <a class="nav-link" href="{{ url_for('auth.logout') }}">
                                <i class="fa fa-power-off"></i> 로그아웃</a>
                            {% else %}
                            <a class="nav-link" href="{{ url_for('auth.login') }}">
                                <i class="menu-icon fa fa-sign-in"></i> 로그인</a>
                            <a class="nav-link" href="{{ url_for('auth.register') }}">
                                <i class="fa fa-user"></i> 회원가입</a>
                            <a class="nav-link" href="{{ url_for('auth.forget_password') }}">
                                <i class="menu-icon fa fa-paper-plane"></i> 비밀번호 찾기</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

        </header><!-- /header -->
        <!-- Header-->

        {% block content_block %}
        {% endblock %} 
    
    </div>

    {% include "page_modules/common_js.html" %}
    {% block js_block %}
    {% endblock %}
    
    <script>
        (function($) {
            "use strict";
            jQuery('#vmap').vectorMap({
                map: 'southkorea_provinces',
                backgroundColor: null,
                enableZoom: true,
                zoomOnScroll: true,
                zoomButtons : true,  // 확대/축소 버튼 비활성화
                panOnDrag: true,
                regionStyle: {
                    initial: {
                        fill: '#B8E4F9',
                        "fill-opacity": 0.7,
                        stroke: '#1C1C1C',
                        "stroke-width": 1,
                        "stroke-opacity": 0.8
                    },
                    hover: {
                        "fill-opacity": 0.8
                    }
                },
                color: '#cceeff',
                borderColor: '#666666',
                borderWidth: 1.4,
                hoverOpacity: 0.7,
                selectedColor: '#009688',
                enableZoom: true,
                showTooltip: true,
                normalizeFunction: 'polynomial',
                // zoomMax: 20,
                onRegionClick: function(event, code, region) {
                    console.log("Clicked Region: ", region);
    
                    // 클릭한 지역의 범죄 데이터 요청
                    $.ajax({
                        url: '/data/get_crime_data_for_region', 
                        method: 'GET',
                        data: { region: region },  // 클릭한 지역 정보 전달
                        success: function(response) {
                            // 받은 데이터를 바탕으로 원그래프 표시
                            showCrimePieChart(response);
                        },
                        error: function(err) {
                            console.error("데이터를 불러오는 데 실패했습니다.", err);
                        }
                    });
                }
            });
    
            // 원그래프 그리기 함수
            function showCrimePieChart(data) {
                var ctx = document.getElementById('crimePieChart').getContext('2d');
                var crimePieChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: data.labels,  // 서버에서 전달받은 레이블
                        datasets: [{
                            label: '범죄 유형 비율',
                            data: data.values,  // 서버에서 전달받은 데이터 값
                            backgroundColor: [
                            '#FFB3BA',  // 소프트 레드
                            '#FFDFBA',  // 라이트 오렌지
                            '#FFFFBA',  // 라이트 옐로우
                            '#BAFFC9',  // 라이트 민트
                            '#BAE1FF',  // 소프트 블루
                            '#C6C6FF',  // 연보라
                            '#FFD6E0',  // 핑크 베이지
                            '#FFF5BA',  // 크림
                            '#D5F4E6',  // 민트 블루
                            '#E2F0CB',  // 연그린
                            '#F6DFEB',  // 소프트 핑크
                            '#FFDAC1',  // 코랄 오렌지
                            '#C7CEEA',  // 연보라 블루
                            '#F8E9A1',  // 옅은 옐로우
                            '#A8D0E6',  // 소프트 하늘색
                            '#D3BCC0',  // 베이지 핑크
                            '#B5EAD7'   // 소프트 민트그린
                        ],
                            hoverBackgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(tooltipItem) {
                                        return tooltipItem.label + ': ' + tooltipItem.raw;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        })(jQuery);
        

        // (function($) {
        //     "use strict";
        //     jQuery('#vmap').vectorMap({
        //                 // map: 'world_en',
        //         // backgroundColor: null,
        //         // color: '#ffffff',
        //         // hoverOpacity: 0.7,
        //         // selectedColor: '#1de9b6',
        //         // enableZoom: true,
        //         // showTooltip: true,
        //         // values: sample_data,
        //         // scaleColors: ['#1de9b6', '#03a9f5'],
        //         // normalizeFunction: 'polynomial'      // 세계지도
        //     });
        // })(jQuery);
    </script>
</body>

</html>
